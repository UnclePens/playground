---
- name: Update and configure Ubuntu server
  hosts: servers
  become: true

  tasks:
    - name: Update apt cache and packages
      apt:
        update_cache: yes
        upgrade: yes

    - name: Allow unattended upgrades
      apt:
        name: unattended-upgrades
        state: present

    - name: Extend logical volume
      community.general.lvol:
        vg: ubuntu-vg
        lv: ubuntu-lv
        size: +100%FREE
        resizefs: true

#    - name: Change hostname
#      hostname:
#        name: <hostname>

#    - name: Update /etc/hosts file
#      lineinfile:
#        path: /etc/hosts
#        line: "{{ ansible_default_ipv4.address }} <hostname>"

    - name: Set timezone to Pacific/Auckland
      community.general.timezone:
        name: Pacific/Auckland

    - name: Install open-vm-tools
      apt:
        name: open-vm-tools
        state: present

    - name: Configure UFW
      blockinfile:
        path: /etc/default/ufw
        block: |
          IPV6=no

    - name: Enable UFW
      community.general.ufw:
        state: enabled
    
    - name: Disable UFW
      community.general.ufw:
        state: disabled

    - name: Allow SSH connections
      community.general.ufw:
        rule: allow
        port: ssh

    - name: Enable UFW
      community.general.ufw:
        state: enabled